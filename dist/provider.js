(()=>{"use strict";window.cryptexa||(window.cryptexa=new class{constructor(){this.isConnected=!1,this.address=null,this.did=null,this.eventHandlers=new Map,this.requestId=0,this.pendingRequests=new Map,window.addEventListener("message",e=>{if(e.source!==window)return;if(!e.data||"cryptexa-page"!==e.data.target)return;const{id:t,response:s}=e.data,n=this.pendingRequests.get(t);n&&(this.pendingRequests.delete(t),s.success?n.resolve(s.data):n.reject(new Error(s.error||"Request failed")))})}async sendMessage(e,t){return new Promise((s,n)=>{const i=++this.requestId;this.pendingRequests.set(i,{resolve:s,reject:n}),window.postMessage({target:"cryptexa-content",id:i,type:e,payload:t},"*"),setTimeout(()=>{this.pendingRequests.has(i)&&(this.pendingRequests.delete(i),n(new Error("Request timeout")))},6e4)})}async requestAccounts(){try{const e=await this.sendMessage("REQUEST_ACCOUNTS");return this.isConnected=!0,this.address=e.address,this.did=e.did,this.emit("connect",{address:this.address,did:this.did}),[e.address]}catch(e){throw new Error("User rejected the request")}}async getBalance(){if(!this.address)throw new Error("Not connected");return await this.sendMessage("GET_BALANCE",{address:this.address})}async sendTransaction(e,t){if(!this.address)throw new Error("Not connected");return await this.sendMessage("SEND_TRANSACTION",{to:e,value:t})}async requestPresentation(e,t,s){if(!this.did)throw new Error("DID not available");const n=window.location.origin;return await this.sendMessage("REQUEST_PRESENTATION",{requestedCredentials:e,challenge:t,requestedClaims:s,domain:n})}async signChallenge(e){if(!this.did)throw new Error("DID not available");const t=window.location.origin;return(await this.sendMessage("SIGN_CHALLENGE",{challenge:e,domain:t})).jwt}on(e,t){this.eventHandlers.has(e)||this.eventHandlers.set(e,new Set),this.eventHandlers.get(e).add(t)}off(e,t){const s=this.eventHandlers.get(e);s&&s.delete(t)}emit(e,t){const s=this.eventHandlers.get(e);s&&s.forEach(e=>e(t))}},window.dispatchEvent(new Event("cryptexa#initialized")),console.log("Cryptexa Wallet Provider initialized"))})();